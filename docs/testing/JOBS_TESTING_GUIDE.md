# 岗位管理功能测试指南

## 测试环境准备

### 1. 启动服务

```bash
# 在项目根目录
./start.sh
```

或分别启动前后端：

```bash
# 后端
cd backend
npm run start:dev

# 前端
cd frontend
npm run dev
```

### 2. 创建测试账号

确保有以下角色的账号：

- **管理员账号**: 用于测试所有功能
- **HR账号**: 用于测试岗位管理权限
- **普通用户账号**: 用于测试权限限制

如果没有，可以通过注册或数据库直接创建。

---

## 功能测试清单

### 一、岗位创建（Create）

#### 测试用例 1.1: 成功创建岗位

**前置条件**: 使用 HR 或管理员账号登录

**步骤**:
1. 访问 `http://localhost:3000/admin/jobs`
2. 点击"新建岗位"按钮
3. 填写必填字段：
   - 岗位名称: "高级前端开发工程师"
   - 所属部门: "技术研发部"
   - 岗位职责: "负责核心产品的前端开发"
   - 任职要求: "3年以上React开发经验"
4. 填写可选字段：
   - 工作地点: "北京"
   - 招聘人数: 2
   - 学历要求: "本科及以上"
   - 工作年限: "3-5年"
   - 薪资范围: "20k-35k"
   - 技能关键词: "React, TypeScript, Node.js"
5. 点击"创建"按钮

**预期结果**:
- ✅ 显示"创建成功"提示
- ✅ 表单自动关闭
- ✅ 列表中显示新创建的岗位
- ✅ 岗位状态显示为"招聘中"

#### 测试用例 1.2: 同部门重复岗位名称

**步骤**:
1. 创建岗位: 部门="技术研发部", 名称="后端工程师"
2. 再次创建: 部门="技术研发部", 名称="后端工程师"

**预期结果**:
- ❌ 显示错误提示: "同部门已存在同名岗位"
- ✅ 第一个岗位创建成功
- ❌ 第二个岗位创建失败

#### 测试用例 1.3: 不同部门可以有相同岗位名称

**步骤**:
1. 创建岗位: 部门="技术研发部", 名称="工程师"
2. 创建岗位: 部门="运营部", 名称="工程师"

**预期结果**:
- ✅ 两个岗位都创建成功
- ✅ 两者可以共存

#### 测试用例 1.4: 必填字段验证

**步骤**:
1. 点击"新建岗位"
2. 只填写岗位名称，其他必填字段留空
3. 点击"创建"

**预期结果**:
- ❌ 显示"请输入所属部门"等提示
- ❌ 表单不会提交

---

### 二、岗位查询（Read）

#### 测试用例 2.1: 查看岗位列表

**步骤**:
1. 访问 `http://localhost:3000/admin/jobs`
2. 查看岗位列表

**预期结果**:
- ✅ 显示所有未删除的岗位
- ✅ 每个岗位卡片显示完整信息
- ✅ 显示总数统计

#### 测试用例 2.2: 按状态筛选

**步骤**:
1. 在筛选框选择"岗位状态 = 招聘中"
2. 点击"搜索"

**预期结果**:
- ✅ 只显示状态为"open"的岗位
- ✅ 显示正确的统计数量

#### 测试用例 2.3: 按部门筛选

**步骤**:
1. 在筛选框选择"所属部门 = 技术研发部"
2. 点击"搜索"

**预期结果**:
- ✅ 只显示技术研发部的岗位
- ✅ 部门下拉框包含所有已存在的部门

#### 测试用例 2.4: 关键词搜索

**步骤**:
1. 在搜索框输入 "React"
2. 按回车或点击"搜索"

**预期结果**:
- ✅ 显示岗位名称、职责或要求中包含"React"的岗位
- ✅ 技能关键词中包含"React"的岗位也会显示

#### 测试用例 2.5: 组合筛选

**步骤**:
1. 关键词: "前端"
2. 状态: "招聘中"
3. 部门: "技术研发部"
4. 点击"搜索"

**预期结果**:
- ✅ 显示同时满足所有条件的岗位
- ✅ 统计数量正确

#### 测试用例 2.6: 重置筛选

**步骤**:
1. 设置多个筛选条件后点击"搜索"
2. 点击"重置"按钮

**预期结果**:
- ✅ 所有筛选条件清空
- ✅ 显示所有岗位

#### 测试用例 2.7: 查看岗位详情

**步骤**:
1. 点击某个岗位卡片的"查看详情"
2. 展开详情区域

**预期结果**:
- ✅ 显示完整的岗位职责
- ✅ 显示完整的任职要求
- ✅ 格式正确（保留换行）

#### 测试用例 2.8: 分页功能

**前置条件**: 创建超过10个岗位

**步骤**:
1. 查看第1页
2. 点击"下一页"
3. 点击"上一页"

**预期结果**:
- ✅ 每页显示10个岗位
- ✅ 显示正确的页码和总页数
- ✅ 第1页时"上一页"按钮禁用
- ✅ 最后一页时"下一页"按钮禁用

---

### 三、岗位更新（Update）

#### 测试用例 3.1: 编辑岗位基本信息

**步骤**:
1. 点击某个岗位的"编辑"按钮
2. 修改岗位名称为 "资深前端开发工程师"
3. 修改招聘人数为 3
4. 点击"保存修改"

**预期结果**:
- ✅ 显示"保存成功"提示
- ✅ 自动返回列表页
- ✅ 列表中显示更新后的信息

#### 测试用例 3.2: 修改岗位状态

**步骤**:
1. 在岗位列表中找到一个"招聘中"的岗位
2. 点击"关闭"按钮
3. 确认操作

**预期结果**:
- ✅ 显示"岗位已关闭"提示
- ✅ 状态标签变为"已关闭"
- ✅ 按钮文字变为"开放"

#### 测试用例 3.3: 重新开放已关闭的岗位

**步骤**:
1. 找到一个"已关闭"的岗位
2. 点击"开放"按钮

**预期结果**:
- ✅ 显示"岗位已开放"提示
- ✅ 状态变回"招聘中"

#### 测试用例 3.4: 在编辑页面修改状态

**步骤**:
1. 进入岗位编辑页面
2. 切换状态单选按钮
3. 保存

**预期结果**:
- ✅ 状态成功更新
- ✅ 返回列表后显示新状态

#### 测试用例 3.5: 修改时的重名检查

**步骤**:
1. 编辑岗位A，将其名称改为岗位B的名称（同部门）
2. 保存

**预期结果**:
- ❌ 显示"同部门已存在同名岗位"错误
- ❌ 修改失败

#### 测试用例 3.6: 修改部门但保持同名

**步骤**:
1. 编辑岗位，只修改部门
2. 保存

**预期结果**:
- ✅ 修改成功（因为换了部门，可以重名）

---

### 四、岗位删除（Delete）

#### 测试用例 4.1: 删除单个岗位

**步骤**:
1. 点击某个岗位的"删除"按钮
2. 在确认对话框中点击"确定"

**预期结果**:
- ✅ 显示"删除成功"提示
- ✅ 岗位从列表中消失
- ✅ 总数统计减1

#### 测试用例 4.2: 取消删除操作

**步骤**:
1. 点击"删除"按钮
2. 在确认对话框中点击"取消"

**预期结果**:
- ✅ 岗位不被删除
- ✅ 仍然显示在列表中

#### 测试用例 4.3: 软删除验证

**步骤**:
1. 删除一个岗位
2. 在数据库中查询该岗位

**预期结果**:
- ✅ 记录仍然存在
- ✅ `is_deleted` 字段为 `true`

---

### 五、权限控制

#### 测试用例 5.1: HR可以管理岗位

**步骤**:
1. 使用HR账号登录
2. 尝试创建、编辑、删除岗位

**预期结果**:
- ✅ 所有操作都成功

#### 测试用例 5.2: 管理员可以管理岗位

**步骤**:
1. 使用管理员账号登录
2. 尝试创建、编辑、删除岗位

**预期结果**:
- ✅ 所有操作都成功

#### 测试用例 5.3: 普通用户不能管理岗位

**步骤**:
1. 使用普通用户账号登录
2. 尝试访问 `/admin/jobs`

**预期结果**:
- ❌ 可能被重定向到其他页面
- ❌ 或者不显示"新建岗位"等操作按钮

#### 测试用例 5.4: 未登录用户无法访问

**步骤**:
1. 退出登录
2. 直接访问 `http://localhost:3000/admin/jobs`

**预期结果**:
- ❌ 被重定向到登录页面

---

### 六、UI/UX 测试

#### 测试用例 6.1: 响应式设计

**步骤**:
1. 在不同屏幕尺寸下查看页面
   - 桌面 (>1024px)
   - 平板 (768px-1024px)
   - 手机 (<768px)

**预期结果**:
- ✅ 布局自适应
- ✅ 按钮和文字大小合适
- ✅ 表单字段排列合理

#### 测试用例 6.2: 加载状态

**步骤**:
1. 打开岗位列表页面
2. 观察首次加载

**预期结果**:
- ✅ 显示"加载中..."提示
- ✅ 数据加载完成后显示列表

#### 测试用例 6.3: 空状态

**步骤**:
1. 删除所有岗位
2. 查看列表页面

**预期结果**:
- ✅ 显示"暂无岗位"提示
- ✅ 显示"新建第一个岗位"按钮

#### 测试用例 6.4: 搜索无结果

**步骤**:
1. 搜索不存在的关键词

**预期结果**:
- ✅ 显示"没有找到符合条件的岗位"
- ✅ 不显示"新建第一个岗位"按钮

---

## API 测试

### 使用 cURL 测试

首先获取 token：

```bash
# 登录获取token
curl -X POST http://localhost:3001/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "your_username",
    "password": "your_password"
  }'

# 保存返回的 token
TOKEN="your_token_here"
```

### 测试创建岗位

```bash
curl -X POST http://localhost:3001/api/jobs \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "测试岗位",
    "department": "测试部门",
    "responsibilities": "测试职责",
    "requirements": "测试要求",
    "skillKeywords": ["测试", "QA"],
    "hiringCount": 1,
    "location": "远程",
    "status": "open"
  }'
```

### 测试获取列表

```bash
curl -X GET "http://localhost:3001/api/jobs?page=1&limit=10" \
  -H "Authorization: Bearer $TOKEN"
```

### 测试搜索

```bash
curl -X GET "http://localhost:3001/api/jobs?keyword=测试&status=open" \
  -H "Authorization: Bearer $TOKEN"
```

### 测试更新

```bash
curl -X PATCH http://localhost:3001/api/jobs/1 \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "status": "closed"
  }'
```

### 测试删除

```bash
curl -X DELETE http://localhost:3001/api/jobs/1 \
  -H "Authorization: Bearer $TOKEN"
```

---

## 数据库验证

### 查询所有岗位

```sql
SELECT * FROM jobs WHERE is_deleted = 0;
```

### 查询某部门的岗位

```sql
SELECT * FROM jobs 
WHERE department = '技术研发部' AND is_deleted = 0;
```

### 查询开放的岗位

```sql
SELECT * FROM jobs 
WHERE status = 'open' AND is_deleted = 0;
```

### 验证唯一性约束

```sql
SELECT department, title, COUNT(*) as count
FROM jobs
WHERE is_deleted = 0
GROUP BY department, title
HAVING count > 1;
```

结果应该为空（没有重复）。

---

## 性能测试

### 测试场景 1: 大量岗位加载

**步骤**:
1. 创建 100+ 个岗位
2. 打开岗位列表页面
3. 测试分页和搜索性能

**预期**:
- 列表加载时间 < 1秒
- 搜索响应时间 < 500ms

### 测试场景 2: 并发创建

**步骤**:
1. 使用工具模拟 10 个用户同时创建岗位

**预期**:
- 所有请求都正确处理
- 没有数据竞争问题

---

## 常见问题排查

### 问题 1: 创建岗位失败

**可能原因**:
- Token 过期或无效
- 用户权限不足（不是HR或管理员）
- 同部门已存在同名岗位
- 必填字段缺失

**排查**:
```bash
# 检查用户角色
SELECT u.username, r.name as role 
FROM users u 
JOIN roles r ON u.role_id = r.id 
WHERE u.username = 'your_username';
```

### 问题 2: 搜索结果不正确

**可能原因**:
- 关键词包含特殊字符
- 筛选条件冲突

**排查**:
- 查看浏览器控制台的网络请求
- 检查后端日志

### 问题 3: 页面空白

**可能原因**:
- 前端未正确启动
- API 调用失败
- 未登录

**排查**:
```bash
# 检查前端进程
ps aux | grep next

# 检查后端进程
ps aux | grep nest

# 查看后端日志
cd backend && npm run start:dev
```

---

## 测试报告模板

```
测试日期: 2025-10-24
测试人员: [您的名字]
测试环境: 
  - 前端: http://localhost:3000
  - 后端: http://localhost:3001
  - 数据库: MySQL 8.0

测试结果:
☐ 岗位创建功能 (9个测试用例)
  ✅ 1.1 成功创建岗位
  ✅ 1.2 同部门重复岗位名称
  ✅ 1.3 不同部门可以有相同岗位名称
  ✅ 1.4 必填字段验证
  
☐ 岗位查询功能 (8个测试用例)
  ✅ 2.1 查看岗位列表
  ✅ 2.2 按状态筛选
  ... (继续列出)

已发现问题:
1. [问题描述]
   - 严重程度: 高/中/低
   - 重现步骤: ...
   - 预期结果: ...
   - 实际结果: ...

测试结论: ✅ 通过 / ❌ 未通过
```

---

## 自动化测试（待实现）

### E2E 测试示例

```typescript
// jobs.e2e-spec.ts
describe('Jobs Management (e2e)', () => {
  it('should create a new job', async () => {
    const response = await request(app.getHttpServer())
      .post('/api/jobs')
      .set('Authorization', `Bearer ${token}`)
      .send({
        title: 'E2E Test Job',
        department: 'Test Dept',
        responsibilities: 'Test responsibilities',
        requirements: 'Test requirements',
      })
      .expect(201);
      
    expect(response.body).toHaveProperty('id');
    expect(response.body.title).toBe('E2E Test Job');
  });
});
```

---

## 结论

完成以上所有测试用例后，岗位管理功能应该能够：

✅ 正确处理CRUD操作
✅ 实施权限控制
✅ 提供良好的用户体验
✅ 保证数据完整性
✅ 具备良好的性能

如有问题，请参考 API 文档或联系开发团队。

